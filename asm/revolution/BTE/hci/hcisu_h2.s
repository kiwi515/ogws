.include "macros.inc"

.section .bss, "wa"
.balign 0x8
.global hcisu_h2_cb
hcisu_h2_cb:
	.skip 0x40

.section .data, "wa"
.balign 0x8
.global lbl_803AF720
lbl_803AF720:
	.incbin "baserom.dol", 0x3AB820, 0x3C
.global lbl_803AF75C
lbl_803AF75C:
	.incbin "baserom.dol", 0x3AB85C, 0x34

.section .rodata, "a"
.balign 0x8
.global hcisu_h2
hcisu_h2:
	.incbin "baserom.dol", 0x378758, 0x18

.section .sdata2, "a"
.balign 0x8
.global hcisu_preamble_table
hcisu_preamble_table:
	.incbin "baserom.dol", 0x3C9FC0, 0x8
.global hcisu_msg_evt_table
hcisu_msg_evt_table:
	.incbin "baserom.dol", 0x3C9FC8, 0x8

.section .text, "ax"
.global hcisu_h2_usb_cback
hcisu_h2_usb_cback:
/* 8010C7B4 001076B4  2C 03 00 04 */	cmpwi r3, 4
/* 8010C7B8 001076B8  41 82 00 14 */	beq lbl_8010C7CC
/* 8010C7BC 001076BC  4C 80 00 20 */	bgelr 
/* 8010C7C0 001076C0  2C 03 00 00 */	cmpwi r3, 0
/* 8010C7C4 001076C4  4D 82 00 20 */	beqlr 
/* 8010C7C8 001076C8  4E 80 00 20 */	blr 
lbl_8010C7CC:
/* 8010C7CC 001076CC  7C 83 07 74 */	extsb r3, r4
/* 8010C7D0 001076D0  48 00 1E D8 */	b bta_usb_close_evt
/* 8010C7D4 001076D4  4E 80 00 20 */	blr 

.global hcisu_h2_receive_msg
hcisu_h2_receive_msg:
/* 8010C7D8 001076D8  94 21 FF A0 */	stwu r1, -0x60(r1)
/* 8010C7DC 001076DC  7C 08 02 A6 */	mflr r0
/* 8010C7E0 001076E0  90 01 00 64 */	stw r0, 0x64(r1)
/* 8010C7E4 001076E4  39 61 00 60 */	addi r11, r1, 0x60
/* 8010C7E8 001076E8  4B FA 55 29 */	bl _savegpr_14
/* 8010C7EC 001076EC  88 04 00 1E */	lbz r0, 0x1e(r4)
/* 8010C7F0 001076F0  7C 8F 23 78 */	mr r15, r4
/* 8010C7F4 001076F4  3A 60 00 00 */	li r19, 0
/* 8010C7F8 001076F8  28 00 00 02 */	cmplwi r0, 2
/* 8010C7FC 001076FC  41 82 00 0C */	beq lbl_8010C808
/* 8010C800 00107700  38 60 00 00 */	li r3, 0
/* 8010C804 00107704  48 00 03 54 */	b lbl_8010CB58
lbl_8010C808:
/* 8010C808 00107708  3A 83 00 01 */	addi r20, r3, 1
/* 8010C80C 0010770C  54 60 0B FC */	rlwinm r0, r3, 1, 0xf, 0x1e
/* 8010C810 00107710  3F E0 80 47 */	lis r31, hcisu_h2_cb@ha
/* 8010C814 00107714  7E C4 1A 14 */	add r22, r4, r3
/* 8010C818 00107718  56 90 04 3E */	clrlwi r16, r20, 0x10
/* 8010C81C 0010771C  54 77 13 BA */	rlwinm r23, r3, 2, 0xe, 0x1d
/* 8010C820 00107720  7E A4 02 14 */	add r21, r4, r0
/* 8010C824 00107724  3B FF 93 E0 */	addi r31, r31, hcisu_h2_cb@l
/* 8010C828 00107728  3B A0 00 00 */	li r29, 0
/* 8010C82C 0010772C  3B C0 00 04 */	li r30, 4
/* 8010C830 00107730  3B 82 99 60 */	addi r28, r2, hcisu_preamble_table-_SDA2_BASE_
/* 8010C834 00107734  3B 20 00 03 */	li r25, 3
/* 8010C838 00107738  3B 00 00 02 */	li r24, 2
/* 8010C83C 0010773C  3D C0 80 3B */	lis r14, 0x803b
/* 8010C840 00107740  3B 42 99 68 */	addi r26, r2, hcisu_msg_evt_table-_SDA2_BASE_
/* 8010C844 00107744  3B 60 00 01 */	li r27, 1
lbl_8010C848:
/* 8010C848 00107748  56 03 06 3E */	clrlwi r3, r16, 0x18
/* 8010C84C 0010774C  38 81 00 08 */	addi r4, r1, 8
/* 8010C850 00107750  38 A0 00 01 */	li r5, 1
/* 8010C854 00107754  48 00 14 65 */	bl UUSB_Read
/* 8010C858 00107758  54 60 04 3F */	clrlwi. r0, r3, 0x10
/* 8010C85C 0010775C  41 82 02 F8 */	beq lbl_8010CB54
/* 8010C860 00107760  88 16 00 1A */	lbz r0, 0x1a(r22)
/* 8010C864 00107764  3A 20 00 00 */	li r17, 0
/* 8010C868 00107768  3A 73 00 01 */	addi r19, r19, 1
/* 8010C86C 0010776C  2C 00 00 02 */	cmpwi r0, 2
/* 8010C870 00107770  41 82 01 C8 */	beq lbl_8010CA38
/* 8010C874 00107774  40 80 00 14 */	bge lbl_8010C888
/* 8010C878 00107778  2C 00 00 00 */	cmpwi r0, 0
/* 8010C87C 0010777C  41 82 00 1C */	beq lbl_8010C898
/* 8010C880 00107780  40 80 00 C0 */	bge lbl_8010C940
/* 8010C884 00107784  48 00 02 B0 */	b lbl_8010CB34
lbl_8010C888:
/* 8010C888 00107788  2C 00 00 04 */	cmpwi r0, 4
/* 8010C88C 0010778C  41 82 02 90 */	beq lbl_8010CB1C
/* 8010C890 00107790  40 80 02 A4 */	bge lbl_8010CB34
/* 8010C894 00107794  48 00 01 F0 */	b lbl_8010CA84
lbl_8010C898:
/* 8010C898 00107798  28 10 00 01 */	cmplwi r16, 1
/* 8010C89C 0010779C  40 82 00 18 */	bne lbl_8010C8B4
/* 8010C8A0 001077A0  38 60 00 02 */	li r3, 2
/* 8010C8A4 001077A4  4B FF E9 65 */	bl GKI_getpoolbuf
/* 8010C8A8 001077A8  7C 6F B9 2E */	stwx r3, r15, r23
/* 8010C8AC 001077AC  9B D6 00 14 */	stb r30, 0x14(r22)
/* 8010C8B0 001077B0  48 00 00 38 */	b lbl_8010C8E8
lbl_8010C8B4:
/* 8010C8B4 001077B4  28 10 00 02 */	cmplwi r16, 2
/* 8010C8B8 001077B8  40 82 00 18 */	bne lbl_8010C8D0
/* 8010C8BC 001077BC  38 60 00 03 */	li r3, 3
/* 8010C8C0 001077C0  4B FF E9 49 */	bl GKI_getpoolbuf
/* 8010C8C4 001077C4  7C 6F B9 2E */	stwx r3, r15, r23
/* 8010C8C8 001077C8  9B 16 00 14 */	stb r24, 0x14(r22)
/* 8010C8CC 001077CC  48 00 00 1C */	b lbl_8010C8E8
lbl_8010C8D0:
/* 8010C8D0 001077D0  28 10 00 03 */	cmplwi r16, 3
/* 8010C8D4 001077D4  40 82 02 60 */	bne lbl_8010CB34
/* 8010C8D8 001077D8  38 60 00 01 */	li r3, 1
/* 8010C8DC 001077DC  4B FF E9 2D */	bl GKI_getpoolbuf
/* 8010C8E0 001077E0  7C 6F B9 2E */	stwx r3, r15, r23
/* 8010C8E4 001077E4  9B 36 00 14 */	stb r25, 0x14(r22)
lbl_8010C8E8:
/* 8010C8E8 001077E8  7C 6F B8 2E */	lwzx r3, r15, r23
/* 8010C8EC 001077EC  2C 03 00 00 */	cmpwi r3, 0
/* 8010C8F0 001077F0  41 82 00 30 */	beq lbl_8010C920
/* 8010C8F4 001077F4  B3 A3 00 02 */	sth r29, 2(r3)
/* 8010C8F8 001077F8  88 16 00 14 */	lbz r0, 0x14(r22)
/* 8010C8FC 001077FC  7C 6F B8 2E */	lwzx r3, r15, r23
/* 8010C900 00107800  54 00 08 3C */	slwi r0, r0, 1
/* 8010C904 00107804  7C 9A 02 14 */	add r4, r26, r0
/* 8010C908 00107808  A0 04 FF FE */	lhz r0, -2(r4)
/* 8010C90C 0010780C  B0 03 00 00 */	sth r0, 0(r3)
/* 8010C910 00107810  7C 6F B8 2E */	lwzx r3, r15, r23
/* 8010C914 00107814  B3 A3 00 04 */	sth r29, 4(r3)
/* 8010C918 00107818  9B 76 00 1A */	stb r27, 0x1a(r22)
/* 8010C91C 0010781C  48 00 00 14 */	b lbl_8010C930
lbl_8010C920:
/* 8010C920 00107820  38 8E F7 20 */	addi r4, r14, -2272
/* 8010C924 00107824  3C 60 00 07 */	lis r3, 7
/* 8010C928 00107828  48 00 1B B1 */	bl LogMsg_0
/* 8010C92C 0010782C  9B 16 00 1A */	stb r24, 0x1a(r22)
lbl_8010C930:
/* 8010C930 00107830  88 16 00 14 */	lbz r0, 0x14(r22)
/* 8010C934 00107834  7C 7C 02 14 */	add r3, r28, r0
/* 8010C938 00107838  88 03 FF FF */	lbz r0, -1(r3)
/* 8010C93C 0010783C  B0 15 00 0C */	sth r0, 0xc(r21)
lbl_8010C940:
/* 8010C940 00107840  7C CF B8 2E */	lwzx r6, r15, r23
/* 8010C944 00107844  88 A1 00 08 */	lbz r5, 8(r1)
/* 8010C948 00107848  A0 86 00 02 */	lhz r4, 2(r6)
/* 8010C94C 0010784C  7C 66 22 14 */	add r3, r6, r4
/* 8010C950 00107850  38 04 00 01 */	addi r0, r4, 1
/* 8010C954 00107854  98 A3 00 08 */	stb r5, 8(r3)
/* 8010C958 00107858  B0 06 00 02 */	sth r0, 2(r6)
/* 8010C95C 0010785C  A0 75 00 0C */	lhz r3, 0xc(r21)
/* 8010C960 00107860  38 63 FF FF */	addi r3, r3, -1
/* 8010C964 00107864  54 60 04 3F */	clrlwi. r0, r3, 0x10
/* 8010C968 00107868  B0 75 00 0C */	sth r3, 0xc(r21)
/* 8010C96C 0010786C  40 82 00 C0 */	bne lbl_8010CA2C
/* 8010C970 00107870  88 16 00 14 */	lbz r0, 0x14(r22)
/* 8010C974 00107874  8A 41 00 08 */	lbz r18, 8(r1)
/* 8010C978 00107878  28 00 00 02 */	cmplwi r0, 2
/* 8010C97C 0010787C  40 82 00 44 */	bne lbl_8010C9C0
/* 8010C980 00107880  88 16 00 17 */	lbz r0, 0x17(r22)
/* 8010C984 00107884  56 44 42 2E */	rlwinm r4, r18, 8, 8, 0x17
/* 8010C988 00107888  7C 6F B8 2E */	lwzx r3, r15, r23
/* 8010C98C 0010788C  7C 04 02 14 */	add r0, r4, r0
/* 8010C990 00107890  54 12 04 3E */	clrlwi r18, r0, 0x10
/* 8010C994 00107894  48 01 D2 51 */	bl l2cap_link_chk_pkt_start
/* 8010C998 00107898  2C 03 00 00 */	cmpwi r3, 0
/* 8010C99C 0010789C  7C 6F B9 2E */	stwx r3, r15, r23
/* 8010C9A0 001078A0  40 82 00 20 */	bne lbl_8010C9C0
/* 8010C9A4 001078A4  2C 12 00 00 */	cmpwi r18, 0
/* 8010C9A8 001078A8  B2 55 00 0C */	sth r18, 0xc(r21)
/* 8010C9AC 001078AC  40 82 00 0C */	bne lbl_8010C9B8
/* 8010C9B0 001078B0  9B B6 00 1A */	stb r29, 0x1a(r22)
/* 8010C9B4 001078B4  48 00 01 80 */	b lbl_8010CB34
lbl_8010C9B8:
/* 8010C9B8 001078B8  9B D6 00 1A */	stb r30, 0x1a(r22)
/* 8010C9BC 001078BC  48 00 01 78 */	b lbl_8010CB34
lbl_8010C9C0:
/* 8010C9C0 001078C0  B2 55 00 0C */	sth r18, 0xc(r21)
/* 8010C9C4 001078C4  7C 6F B8 2E */	lwzx r3, r15, r23
/* 8010C9C8 001078C8  4B FF EA 99 */	bl GKI_get_buf_size
/* 8010C9CC 001078CC  88 16 00 14 */	lbz r0, 0x14(r22)
/* 8010C9D0 001078D0  54 64 04 3E */	clrlwi r4, r3, 0x10
/* 8010C9D4 001078D4  7C 7C 02 14 */	add r3, r28, r0
/* 8010C9D8 001078D8  88 03 FF FF */	lbz r0, -1(r3)
/* 8010C9DC 001078DC  7C 72 02 14 */	add r3, r18, r0
/* 8010C9E0 001078E0  38 03 00 08 */	addi r0, r3, 8
/* 8010C9E4 001078E4  7C 00 20 40 */	cmplw r0, r4
/* 8010C9E8 001078E8  40 81 00 28 */	ble lbl_8010CA10
/* 8010C9EC 001078EC  7C 6F B8 2E */	lwzx r3, r15, r23
/* 8010C9F0 001078F0  4B FF E9 01 */	bl GKI_freebuf
/* 8010C9F4 001078F4  7F AF B9 2E */	stwx r29, r15, r23
/* 8010C9F8 001078F8  3C 60 80 3B */	lis r3, lbl_803AF75C@ha
/* 8010C9FC 001078FC  38 83 F7 5C */	addi r4, r3, lbl_803AF75C@l
/* 8010CA00 00107900  9B D6 00 1A */	stb r30, 0x1a(r22)
/* 8010CA04 00107904  3C 60 00 07 */	lis r3, 7
/* 8010CA08 00107908  48 00 1A D1 */	bl LogMsg_0
/* 8010CA0C 0010790C  48 00 01 28 */	b lbl_8010CB34
lbl_8010CA10:
/* 8010CA10 00107910  2C 12 00 00 */	cmpwi r18, 0
/* 8010CA14 00107914  41 82 00 0C */	beq lbl_8010CA20
/* 8010CA18 00107918  9B 36 00 1A */	stb r25, 0x1a(r22)
/* 8010CA1C 0010791C  48 00 01 18 */	b lbl_8010CB34
lbl_8010CA20:
/* 8010CA20 00107920  9B B6 00 1A */	stb r29, 0x1a(r22)
/* 8010CA24 00107924  3A 20 00 01 */	li r17, 1
/* 8010CA28 00107928  48 00 01 0C */	b lbl_8010CB34
lbl_8010CA2C:
/* 8010CA2C 0010792C  88 01 00 08 */	lbz r0, 8(r1)
/* 8010CA30 00107930  98 16 00 17 */	stb r0, 0x17(r22)
/* 8010CA34 00107934  48 00 01 00 */	b lbl_8010CB34
lbl_8010CA38:
/* 8010CA38 00107938  A0 75 00 0C */	lhz r3, 0xc(r21)
/* 8010CA3C 0010793C  38 63 FF FF */	addi r3, r3, -1
/* 8010CA40 00107940  54 60 04 3F */	clrlwi. r0, r3, 0x10
/* 8010CA44 00107944  B0 75 00 0C */	sth r3, 0xc(r21)
/* 8010CA48 00107948  40 82 00 30 */	bne lbl_8010CA78
/* 8010CA4C 0010794C  88 16 00 14 */	lbz r0, 0x14(r22)
/* 8010CA50 00107950  88 61 00 08 */	lbz r3, 8(r1)
/* 8010CA54 00107954  28 00 00 02 */	cmplwi r0, 2
/* 8010CA58 00107958  40 82 00 14 */	bne lbl_8010CA6C
/* 8010CA5C 0010795C  88 16 00 17 */	lbz r0, 0x17(r22)
/* 8010CA60 00107960  54 63 42 2E */	rlwinm r3, r3, 8, 8, 0x17
/* 8010CA64 00107964  7C 03 02 14 */	add r0, r3, r0
/* 8010CA68 00107968  54 03 04 3E */	clrlwi r3, r0, 0x10
lbl_8010CA6C:
/* 8010CA6C 0010796C  B0 75 00 0C */	sth r3, 0xc(r21)
/* 8010CA70 00107970  9B D6 00 1A */	stb r30, 0x1a(r22)
/* 8010CA74 00107974  48 00 00 C0 */	b lbl_8010CB34
lbl_8010CA78:
/* 8010CA78 00107978  88 01 00 08 */	lbz r0, 8(r1)
/* 8010CA7C 0010797C  98 16 00 17 */	stb r0, 0x17(r22)
/* 8010CA80 00107980  48 00 00 B4 */	b lbl_8010CB34
lbl_8010CA84:
/* 8010CA84 00107984  7C EF B8 2E */	lwzx r7, r15, r23
/* 8010CA88 00107988  56 83 06 3E */	clrlwi r3, r20, 0x18
/* 8010CA8C 0010798C  88 C1 00 08 */	lbz r6, 8(r1)
/* 8010CA90 00107990  A0 A7 00 02 */	lhz r5, 2(r7)
/* 8010CA94 00107994  7C 87 2A 14 */	add r4, r7, r5
/* 8010CA98 00107998  38 05 00 01 */	addi r0, r5, 1
/* 8010CA9C 0010799C  98 C4 00 08 */	stb r6, 8(r4)
/* 8010CAA0 001079A0  B0 07 00 02 */	sth r0, 2(r7)
/* 8010CAA4 001079A4  A0 95 00 0C */	lhz r4, 0xc(r21)
/* 8010CAA8 001079A8  38 04 FF FF */	addi r0, r4, -1
/* 8010CAAC 001079AC  B0 15 00 0C */	sth r0, 0xc(r21)
/* 8010CAB0 001079B0  54 05 04 3E */	clrlwi r5, r0, 0x10
/* 8010CAB4 001079B4  7C 8F B8 2E */	lwzx r4, r15, r23
/* 8010CAB8 001079B8  A0 04 00 02 */	lhz r0, 2(r4)
/* 8010CABC 001079BC  7C 84 02 14 */	add r4, r4, r0
/* 8010CAC0 001079C0  38 84 00 08 */	addi r4, r4, 8
/* 8010CAC4 001079C4  48 00 11 F5 */	bl UUSB_Read
/* 8010CAC8 001079C8  7C 8F B8 2E */	lwzx r4, r15, r23
/* 8010CACC 001079CC  7E 73 1A 14 */	add r19, r19, r3
/* 8010CAD0 001079D0  A0 04 00 02 */	lhz r0, 2(r4)
/* 8010CAD4 001079D4  7C 00 1A 14 */	add r0, r0, r3
/* 8010CAD8 001079D8  B0 04 00 02 */	sth r0, 2(r4)
/* 8010CADC 001079DC  A0 15 00 0C */	lhz r0, 0xc(r21)
/* 8010CAE0 001079E0  7C 63 00 50 */	subf r3, r3, r0
/* 8010CAE4 001079E4  54 60 04 3F */	clrlwi. r0, r3, 0x10
/* 8010CAE8 001079E8  B0 75 00 0C */	sth r3, 0xc(r21)
/* 8010CAEC 001079EC  40 82 00 48 */	bne lbl_8010CB34
/* 8010CAF0 001079F0  88 16 00 14 */	lbz r0, 0x14(r22)
/* 8010CAF4 001079F4  28 00 00 02 */	cmplwi r0, 2
/* 8010CAF8 001079F8  40 82 00 18 */	bne lbl_8010CB10
/* 8010CAFC 001079FC  48 01 D2 B9 */	bl l2cap_link_chk_pkt_end
/* 8010CB00 00107A00  54 60 06 3F */	clrlwi. r0, r3, 0x18
/* 8010CB04 00107A04  40 82 00 0C */	bne lbl_8010CB10
/* 8010CB08 00107A08  9B B6 00 1A */	stb r29, 0x1a(r22)
/* 8010CB0C 00107A0C  48 00 00 28 */	b lbl_8010CB34
lbl_8010CB10:
/* 8010CB10 00107A10  9B B6 00 1A */	stb r29, 0x1a(r22)
/* 8010CB14 00107A14  3A 20 00 01 */	li r17, 1
/* 8010CB18 00107A18  48 00 00 1C */	b lbl_8010CB34
lbl_8010CB1C:
/* 8010CB1C 00107A1C  A0 75 00 0C */	lhz r3, 0xc(r21)
/* 8010CB20 00107A20  38 63 FF FF */	addi r3, r3, -1
/* 8010CB24 00107A24  54 60 04 3F */	clrlwi. r0, r3, 0x10
/* 8010CB28 00107A28  B0 75 00 0C */	sth r3, 0xc(r21)
/* 8010CB2C 00107A2C  40 82 00 08 */	bne lbl_8010CB34
/* 8010CB30 00107A30  9B B6 00 1A */	stb r29, 0x1a(r22)
lbl_8010CB34:
/* 8010CB34 00107A34  2C 11 00 00 */	cmpwi r17, 0
/* 8010CB38 00107A38  41 82 FD 10 */	beq lbl_8010C848
/* 8010CB3C 00107A3C  88 7F 00 1F */	lbz r3, 0x1f(r31)
/* 8010CB40 00107A40  38 80 00 00 */	li r4, 0
/* 8010CB44 00107A44  7C AF B8 2E */	lwzx r5, r15, r23
/* 8010CB48 00107A48  4B FF E9 5D */	bl GKI_send_msg
/* 8010CB4C 00107A4C  7F AF B9 2E */	stwx r29, r15, r23
/* 8010CB50 00107A50  4B FF FC F8 */	b lbl_8010C848
lbl_8010CB54:
/* 8010CB54 00107A54  7E 63 9B 78 */	mr r3, r19
lbl_8010CB58:
/* 8010CB58 00107A58  39 61 00 60 */	addi r11, r1, 0x60
/* 8010CB5C 00107A5C  4B FA 52 01 */	bl _restgpr_14
/* 8010CB60 00107A60  80 01 00 64 */	lwz r0, 0x64(r1)
/* 8010CB64 00107A64  7C 08 03 A6 */	mtlr r0
/* 8010CB68 00107A68  38 21 00 60 */	addi r1, r1, 0x60
/* 8010CB6C 00107A6C  4E 80 00 20 */	blr 

.global hcisu_h2_send_msg_now
hcisu_h2_send_msg_now:
/* 8010CB70 00107A70  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8010CB74 00107A74  7C 08 02 A6 */	mflr r0
/* 8010CB78 00107A78  90 01 00 24 */	stw r0, 0x24(r1)
/* 8010CB7C 00107A7C  39 61 00 20 */	addi r11, r1, 0x20
/* 8010CB80 00107A80  4B FA 51 C5 */	bl _savegpr_27
/* 8010CB84 00107A84  A0 A4 00 00 */	lhz r5, 0(r4)
/* 8010CB88 00107A88  7C 9B 23 78 */	mr r27, r4
/* 8010CB8C 00107A8C  A0 04 00 04 */	lhz r0, 4(r4)
/* 8010CB90 00107A90  28 05 21 00 */	cmplwi r5, 0x2100
/* 8010CB94 00107A94  7C 64 02 14 */	add r3, r4, r0
/* 8010CB98 00107A98  38 C3 00 08 */	addi r6, r3, 8
/* 8010CB9C 00107A9C  40 82 00 0C */	bne lbl_8010CBA8
/* 8010CBA0 00107AA0  3B 80 00 02 */	li r28, 2
/* 8010CBA4 00107AA4  48 00 00 20 */	b lbl_8010CBC4
lbl_8010CBA8:
/* 8010CBA8 00107AA8  28 05 22 00 */	cmplwi r5, 0x2200
/* 8010CBAC 00107AAC  40 82 00 0C */	bne lbl_8010CBB8
/* 8010CBB0 00107AB0  3B 80 00 03 */	li r28, 3
/* 8010CBB4 00107AB4  48 00 00 10 */	b lbl_8010CBC4
lbl_8010CBB8:
/* 8010CBB8 00107AB8  28 05 20 00 */	cmplwi r5, 0x2000
/* 8010CBBC 00107ABC  40 82 00 08 */	bne lbl_8010CBC4
/* 8010CBC0 00107AC0  3B 80 00 00 */	li r28, 0
lbl_8010CBC4:
/* 8010CBC4 00107AC4  28 05 21 00 */	cmplwi r5, 0x2100
/* 8010CBC8 00107AC8  40 82 01 20 */	bne lbl_8010CCE8
/* 8010CBCC 00107ACC  3C 60 80 47 */	lis r3, lbl_8046CC90@ha
/* 8010CBD0 00107AD0  A0 84 00 02 */	lhz r4, 2(r4)
/* 8010CBD4 00107AD4  3B C3 CC 90 */	addi r30, r3, lbl_8046CC90@l
/* 8010CBD8 00107AD8  A0 1E 00 7E */	lhz r0, 0x7e(r30)
/* 8010CBDC 00107ADC  7C 04 00 40 */	cmplw r4, r0
/* 8010CBE0 00107AE0  40 81 01 08 */	ble lbl_8010CCE8
/* 8010CBE4 00107AE4  88 06 00 01 */	lbz r0, 1(r6)
/* 8010CBE8 00107AE8  88 66 00 00 */	lbz r3, 0(r6)
/* 8010CBEC 00107AEC  38 C6 00 02 */	addi r6, r6, 2
/* 8010CBF0 00107AF0  54 00 44 2E */	rlwinm r0, r0, 8, 0x10, 0x17
/* 8010CBF4 00107AF4  7C 03 02 14 */	add r0, r3, r0
/* 8010CBF8 00107AF8  54 00 04 3E */	clrlwi r0, r0, 0x10
/* 8010CBFC 00107AFC  70 00 CF FF */	andi. r0, r0, 0xcfff
/* 8010CC00 00107B00  60 1F 10 00 */	ori r31, r0, 0x1000
/* 8010CC04 00107B04  7F FD 46 70 */	srawi r29, r31, 8
/* 8010CC08 00107B08  48 00 00 D0 */	b lbl_8010CCD8
lbl_8010CC0C:
/* 8010CC0C 00107B0C  7C C4 33 78 */	mr r4, r6
/* 8010CC10 00107B10  7F 83 E3 78 */	mr r3, r28
/* 8010CC14 00107B14  7F 66 DB 78 */	mr r6, r27
/* 8010CC18 00107B18  48 00 10 A9 */	bl UUSB_Write
/* 8010CC1C 00107B1C  A0 7B 00 04 */	lhz r3, 4(r27)
/* 8010CC20 00107B20  A0 1E 00 7C */	lhz r0, 0x7c(r30)
/* 8010CC24 00107B24  A0 9B 00 02 */	lhz r4, 2(r27)
/* 8010CC28 00107B28  7C 03 02 14 */	add r0, r3, r0
/* 8010CC2C 00107B2C  B0 1B 00 04 */	sth r0, 4(r27)
/* 8010CC30 00107B30  54 00 04 3E */	clrlwi r0, r0, 0x10
/* 8010CC34 00107B34  7C 7B 02 14 */	add r3, r27, r0
/* 8010CC38 00107B38  A0 1E 00 7C */	lhz r0, 0x7c(r30)
/* 8010CC3C 00107B3C  38 C3 00 0A */	addi r6, r3, 0xa
/* 8010CC40 00107B40  7C 00 20 50 */	subf r0, r0, r4
/* 8010CC44 00107B44  B0 1B 00 02 */	sth r0, 2(r27)
/* 8010CC48 00107B48  9B E3 00 08 */	stb r31, 8(r3)
/* 8010CC4C 00107B4C  9B A3 00 09 */	stb r29, 9(r3)
/* 8010CC50 00107B50  A0 7B 00 02 */	lhz r3, 2(r27)
/* 8010CC54 00107B54  A0 1E 00 7E */	lhz r0, 0x7e(r30)
/* 8010CC58 00107B58  7C 03 00 40 */	cmplw r3, r0
/* 8010CC5C 00107B5C  40 81 00 20 */	ble lbl_8010CC7C
/* 8010CC60 00107B60  A0 1E 00 7C */	lhz r0, 0x7c(r30)
/* 8010CC64 00107B64  98 06 00 00 */	stb r0, 0(r6)
/* 8010CC68 00107B68  A0 1E 00 7C */	lhz r0, 0x7c(r30)
/* 8010CC6C 00107B6C  7C 00 46 70 */	srawi r0, r0, 8
/* 8010CC70 00107B70  98 06 00 01 */	stb r0, 1(r6)
/* 8010CC74 00107B74  38 C6 00 02 */	addi r6, r6, 2
/* 8010CC78 00107B78  48 00 00 20 */	b lbl_8010CC98
lbl_8010CC7C:
/* 8010CC7C 00107B7C  38 03 FF FC */	addi r0, r3, -4
/* 8010CC80 00107B80  98 06 00 00 */	stb r0, 0(r6)
/* 8010CC84 00107B84  A0 7B 00 02 */	lhz r3, 2(r27)
/* 8010CC88 00107B88  38 03 FF FC */	addi r0, r3, -4
/* 8010CC8C 00107B8C  7C 00 46 70 */	srawi r0, r0, 8
/* 8010CC90 00107B90  98 06 00 01 */	stb r0, 1(r6)
/* 8010CC94 00107B94  38 C6 00 02 */	addi r6, r6, 2
lbl_8010CC98:
/* 8010CC98 00107B98  A0 7B 00 06 */	lhz r3, 6(r27)
/* 8010CC9C 00107B9C  2C 03 00 00 */	cmpwi r3, 0
/* 8010CCA0 00107BA0  41 82 00 38 */	beq lbl_8010CCD8
/* 8010CCA4 00107BA4  38 63 FF FF */	addi r3, r3, -1
/* 8010CCA8 00107BA8  54 60 04 3F */	clrlwi. r0, r3, 0x10
/* 8010CCAC 00107BAC  B0 7B 00 06 */	sth r3, 6(r27)
/* 8010CCB0 00107BB0  40 82 00 28 */	bne lbl_8010CCD8
/* 8010CCB4 00107BB4  38 00 19 00 */	li r0, 0x1900
/* 8010CCB8 00107BB8  3C 60 80 47 */	lis r3, hcisu_h2_cb@ha
/* 8010CCBC 00107BBC  B0 1B 00 00 */	sth r0, 0(r27)
/* 8010CCC0 00107BC0  38 63 93 E0 */	addi r3, r3, hcisu_h2_cb@l
/* 8010CCC4 00107BC4  7F 65 DB 78 */	mr r5, r27
/* 8010CCC8 00107BC8  38 80 00 00 */	li r4, 0
/* 8010CCCC 00107BCC  88 63 00 1F */	lbz r3, 0x1f(r3)
/* 8010CCD0 00107BD0  4B FF E7 D5 */	bl GKI_send_msg
/* 8010CCD4 00107BD4  48 00 00 30 */	b lbl_8010CD04
lbl_8010CCD8:
/* 8010CCD8 00107BD8  A0 BE 00 7E */	lhz r5, 0x7e(r30)
/* 8010CCDC 00107BDC  A0 1B 00 02 */	lhz r0, 2(r27)
/* 8010CCE0 00107BE0  7C 00 28 40 */	cmplw r0, r5
/* 8010CCE4 00107BE4  41 81 FF 28 */	bgt lbl_8010CC0C
lbl_8010CCE8:
/* 8010CCE8 00107BE8  A0 BB 00 02 */	lhz r5, 2(r27)
/* 8010CCEC 00107BEC  7C C4 33 78 */	mr r4, r6
/* 8010CCF0 00107BF0  7F 83 E3 78 */	mr r3, r28
/* 8010CCF4 00107BF4  7F 66 DB 78 */	mr r6, r27
/* 8010CCF8 00107BF8  48 00 0F C9 */	bl UUSB_Write
/* 8010CCFC 00107BFC  7F 63 DB 78 */	mr r3, r27
/* 8010CD00 00107C00  4B FF E5 F1 */	bl GKI_freebuf
lbl_8010CD04:
/* 8010CD04 00107C04  39 61 00 20 */	addi r11, r1, 0x20
/* 8010CD08 00107C08  4B FA 50 89 */	bl _restgpr_27
/* 8010CD0C 00107C0C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8010CD10 00107C10  7C 08 03 A6 */	mtlr r0
/* 8010CD14 00107C14  38 21 00 20 */	addi r1, r1, 0x20
/* 8010CD18 00107C18  4E 80 00 20 */	blr 

.global hcisu_h2_init
hcisu_h2_init:
/* 8010CD1C 00107C1C  3C C0 80 47 */	lis r6, hcisu_h2_cb@ha
/* 8010CD20 00107C20  38 00 00 00 */	li r0, 0
/* 8010CD24 00107C24  38 C6 93 E0 */	addi r6, r6, hcisu_h2_cb@l
/* 8010CD28 00107C28  98 06 00 1E */	stb r0, 0x1e(r6)
/* 8010CD2C 00107C2C  98 06 00 1A */	stb r0, 0x1a(r6)
/* 8010CD30 00107C30  98 06 00 1B */	stb r0, 0x1b(r6)
/* 8010CD34 00107C34  98 06 00 1C */	stb r0, 0x1c(r6)
/* 8010CD38 00107C38  98 66 00 1F */	stb r3, 0x1f(r6)
/* 8010CD3C 00107C3C  98 86 00 20 */	stb r4, 0x20(r6)
/* 8010CD40 00107C40  B0 A6 00 12 */	sth r5, 0x12(r6)
/* 8010CD44 00107C44  4E 80 00 20 */	blr 

.global hcisu_h2_open
hcisu_h2_open:
/* 8010CD48 00107C48  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8010CD4C 00107C4C  7C 08 02 A6 */	mflr r0
/* 8010CD50 00107C50  3C A0 80 47 */	lis r5, hcisu_h2_cb@ha
/* 8010CD54 00107C54  90 01 00 24 */	stw r0, 0x24(r1)
/* 8010CD58 00107C58  38 00 00 00 */	li r0, 0
/* 8010CD5C 00107C5C  38 A5 93 E0 */	addi r5, r5, hcisu_h2_cb@l
/* 8010CD60 00107C60  98 01 00 13 */	stb r0, 0x13(r1)
/* 8010CD64 00107C64  38 00 00 02 */	li r0, 2
/* 8010CD68 00107C68  88 85 00 1F */	lbz r4, 0x1f(r5)
/* 8010CD6C 00107C6C  A0 C3 00 00 */	lhz r6, 0(r3)
/* 8010CD70 00107C70  B0 C1 00 0C */	sth r6, 0xc(r1)
/* 8010CD74 00107C74  A0 C3 00 02 */	lhz r6, 2(r3)
/* 8010CD78 00107C78  38 61 00 08 */	addi r3, r1, 8
/* 8010CD7C 00107C7C  B0 C1 00 0E */	sth r6, 0xe(r1)
/* 8010CD80 00107C80  B0 81 00 10 */	sth r4, 0x10(r1)
/* 8010CD84 00107C84  98 05 00 1E */	stb r0, 0x1e(r5)
/* 8010CD88 00107C88  48 00 0B AD */	bl UUSB_Register
/* 8010CD8C 00107C8C  3C 80 80 11 */	lis r4, hcisu_h2_usb_cback@ha
/* 8010CD90 00107C90  38 61 00 08 */	addi r3, r1, 8
/* 8010CD94 00107C94  38 84 C7 B4 */	addi r4, r4, hcisu_h2_usb_cback@l
/* 8010CD98 00107C98  48 00 0E 09 */	bl UUSB_Open
/* 8010CD9C 00107C9C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8010CDA0 00107CA0  38 60 00 01 */	li r3, 1
/* 8010CDA4 00107CA4  7C 08 03 A6 */	mtlr r0
/* 8010CDA8 00107CA8  38 21 00 20 */	addi r1, r1, 0x20
/* 8010CDAC 00107CAC  4E 80 00 20 */	blr 

.global hcisu_h2_close
hcisu_h2_close:
/* 8010CDB0 00107CB0  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8010CDB4 00107CB4  7C 08 02 A6 */	mflr r0
/* 8010CDB8 00107CB8  3C 60 80 47 */	lis r3, hcisu_h2_cb@ha
/* 8010CDBC 00107CBC  90 01 00 14 */	stw r0, 0x14(r1)
/* 8010CDC0 00107CC0  38 00 00 00 */	li r0, 0
/* 8010CDC4 00107CC4  38 63 93 E0 */	addi r3, r3, hcisu_h2_cb@l
/* 8010CDC8 00107CC8  98 03 00 1E */	stb r0, 0x1e(r3)
/* 8010CDCC 00107CCC  48 00 14 7D */	bl UUSB_Close
/* 8010CDD0 00107CD0  48 00 15 25 */	bl UUSB_Unregister
/* 8010CDD4 00107CD4  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8010CDD8 00107CD8  7C 08 03 A6 */	mtlr r0
/* 8010CDDC 00107CDC  38 21 00 10 */	addi r1, r1, 0x10
/* 8010CDE0 00107CE0  4E 80 00 20 */	blr 

.global hcisu_h2_send
hcisu_h2_send:
/* 8010CDE4 00107CE4  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8010CDE8 00107CE8  7C 08 02 A6 */	mflr r0
/* 8010CDEC 00107CEC  3C A0 80 47 */	lis r5, hcisu_h2_cb@ha
/* 8010CDF0 00107CF0  7C 64 1B 78 */	mr r4, r3
/* 8010CDF4 00107CF4  90 01 00 14 */	stw r0, 0x14(r1)
/* 8010CDF8 00107CF8  38 65 93 E0 */	addi r3, r5, hcisu_h2_cb@l
/* 8010CDFC 00107CFC  4B FF FD 75 */	bl hcisu_h2_send_msg_now
/* 8010CE00 00107D00  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8010CE04 00107D04  38 60 00 01 */	li r3, 1
/* 8010CE08 00107D08  7C 08 03 A6 */	mtlr r0
/* 8010CE0C 00107D0C  38 21 00 10 */	addi r1, r1, 0x10
/* 8010CE10 00107D10  4E 80 00 20 */	blr 

.global hcisu_h2_handle_event
hcisu_h2_handle_event:
/* 8010CE14 00107D14  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8010CE18 00107D18  7C 08 02 A6 */	mflr r0
/* 8010CE1C 00107D1C  3C 80 80 47 */	lis r4, hcisu_h2_cb@ha
/* 8010CE20 00107D20  90 01 00 14 */	stw r0, 0x14(r1)
/* 8010CE24 00107D24  38 84 93 E0 */	addi r4, r4, hcisu_h2_cb@l
/* 8010CE28 00107D28  38 03 FF F8 */	addi r0, r3, -8
/* 8010CE2C 00107D2C  A0 64 00 12 */	lhz r3, 0x12(r4)
/* 8010CE30 00107D30  7C 03 00 50 */	subf r0, r3, r0
/* 8010CE34 00107D34  54 03 04 3E */	clrlwi r3, r0, 0x10
/* 8010CE38 00107D38  4B FF F9 A1 */	bl hcisu_h2_receive_msg
/* 8010CE3C 00107D3C  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8010CE40 00107D40  38 60 00 00 */	li r3, 0
/* 8010CE44 00107D44  7C 08 03 A6 */	mtlr r0
/* 8010CE48 00107D48  38 21 00 10 */	addi r1, r1, 0x10
/* 8010CE4C 00107D4C  4E 80 00 20 */	blr 
